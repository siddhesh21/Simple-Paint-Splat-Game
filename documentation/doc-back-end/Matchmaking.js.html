<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Matchmaking.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Matchmaking.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Constants = require('../lib/constants');
const GameSupervisor = require('./GameSupervisor');

/**
 * Class providing a matchmaking system: groups players in lobbies and create games
 */
class Matchmaking {
    /** Available colors for players */
    static colors = Constants.DEFAULT_COLORS;

    /**
     * Create a new matchmaking system (a single Matchmaking instance is
     * sufficient for the lobbies to work
     * @param {*} io The Socket.io connection
     */
    constructor(io) {
        this.io = io;
        this.players = [];
        this.currTime = Constants.MAXIMUM_LOBBY_WAIT_TIME;
        this.timer = null;
    }

    /**
     * Initializes the timer of the matchmaking system.
     */
    initTimer() {
        this.timer = setInterval(() => {
            this.currTime--;
            if (this.currTime &lt;= 0) {
                this.createGame();
                this.resetMatchmaking();
            }
        }, 1000);
    }

    /**
     * Resets matchmaking to create a new lobby (reset players and timer)
     */
    resetMatchmaking() {
        this.players = [];
        clearInterval(this.timer);
        this.currTime = Constants.MAXIMUM_LOBBY_WAIT_TIME;
    }

    /**
     * Adds a new player to the current matchmaking (i.e. lobby) being populated
     * @param {*} player Player to add to the lobby
     */
    addPlayer(player) {
        player.color = Matchmaking.colors[this.players.length];
        player.score = 0;
        this.players.push(player);

        if (this.players.length == 1) {
            this.initTimer();
        }

        // Send information about lobby to client
        let sendPlayers = []
        for (const p of this.players)
            sendPlayers.push(p.getObj());

        for (const player of this.players)Â {
            if (player.socket) {
                player.socket.emit('lobbyJoined', {
                    timeRemaining: this.currTime,
                    players: sendPlayers
                });
            }
        }

        // Ensure lobbyJoined has been received before gameStart
        setTimeout(() => {
            if (this.players.length == Constants.MAX_PLAYERS_PER_GAME) {
                this.createGame(false);
            }
        }, 1000);
    }

    /**
     * Creates a game with the players of the current lobby
     * @param {boolean} useAI If true, second player of the list will be replaced
     * by AI by the GameSupervisor (used in single player mode only)
     */
    createGame(useAI) {
        new GameSupervisor(this.io, this.players, useAI);
        this.resetMatchmaking();
    }
}

module.exports = Matchmaking;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="GameSupervisor.html">GameSupervisor</a></li><li><a href="Matchmaking.html">Matchmaking</a></li><li><a href="Player.html">Player</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue Nov 17 2020 00:17:27 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
